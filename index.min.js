class LPDF{constructor(e){this.id=e;let t=import.meta.url.split('/');t.pop(),this.location=t.join('/')+'/';let n=document.createElement('script');n.src='https://cdn.jsdelivr.net/npm/pdfjs-dist/build/pdf.js',document.getElementsByTagName('head')[0].appendChild(n),setInterval((()=>{if('undefined'==typeof pdfjsLib)throw'Impossible d\'utiliser le module LPDF : PDF.js not set on meta';}),1e3);let l=document.createElement('div');l.classList.add('dialog-lpdf'),l.innerHTML='<div class="content-lpdf">\n            <div class="body-lpdf"></div>\n            <div class="footer-lpdf">\n                <div class="buttons-right">\n                    <button id="closeLPDF" class="btn-lpdf">\n                        <i class="bi bi-x"></i>\n                    </button>\n                </div>\n                <div class="buttons-navigation">\n                    <button id="PreviousPage" class="btn-lpdf">\n                        <i class="bi bi-chevron-left"></i>\n                    </button>\n                    <div class="input-group-lpdf">\n                        <input class="form-control-lpdf" type="number" name="currentPage" id="currentPage" min="1" value="1" aria-label="currentPage" onload="this.value=1" />\n                        <span class="input-group-text-lpdf" >/<span id="numberPage">0</span></span>\n                    </div>\n                    <button id="NextPage" class="btn-lpdf">\n                        <i class="bi bi-chevron-right"></i>\n                    </button>\n                </div>\n            </div>\n        </div>',document.getElementById(e).append(l),document.getElementById(e).classList.add('lpdf','fade');let s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let e=document.createElement('style');e.innerHTML=this.responseText,document.getElementsByTagName('head')[0].appendChild(e);}},s.open('GET',this.location+'/css/main.min.css'),s.send(),document.getElementById(e).querySelector('input').addEventListener('change',(()=>{document.getElementById(e).querySelector('canvas#page'+CSS.escape(document.getElementById(e).querySelector('input').value)).scrollIntoView();})),document.getElementById(e).querySelectorAll('#PreviousPage,#NextPage').forEach((t=>{t.addEventListener('click',(()=>{let n=document.getElementById(e).querySelector('input'),l=parseInt(n.value);n.value=(l+('NextPage'==t.id?l!=document.getElementById(e).querySelectorAll('canvas').length?1:0:1!=l?-1:0)).toString(),document.getElementById(e).querySelector('canvas#page'+CSS.escape(n.value)).scrollIntoView();}));})),document.getElementById(e).querySelector('.buttons-right > #closeLPDF').addEventListener('click',(()=>{this.close(e);})),document.getElementById(e).querySelector('.body-lpdf').addEventListener('scroll',(()=>{let t=document.getElementById(e).querySelector('#currentPage'),n=document.getElementById(e).querySelector('canvas#page'+CSS.escape(t.value)).getBoundingClientRect(),l=n.bottom,s=n.top;l>n.height+window.innerHeight/2&&s>window.innerHeight/2?t.value=parseInt(t.value)-1:l<window.innerHeight/2&&s<-window.innerHeight/2&&(t.value=parseInt(t.value)+1);}));}renderPDF(e){let t=document.getElementById(this.id);if(this.lazyLoad!=e){this.lazyLoad=e,t.querySelectorAll('canvas').forEach((e=>e.remove())),pdfjsLib.GlobalWorkerOptions.workerSrc&&(pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdn.jsdelivr.net/npm/pdfjs-dist/build/pdf.worker.js'),pdfjsLib.getDocument(e).promise.then((function(e){t.querySelector('#numberPage').textContent=e.numPages,t.querySelector('input').value='1',t.querySelector('input').max=e.numPages;for(let n=1;n<=e.numPages;n++)e.getPage(n).then((function(e){let l=e.getViewport({scale:1.5}),s=document.createElement('canvas');s.id=`page${n}`,t.querySelector('.body-lpdf').append(s);let d=s.getContext('2d');s.height=l.height,s.width=l.width;let o={canvasContext:d,viewport:l};e.render(o);}));}),(function(e){console.error(e);}));}}open(){let e=document.getElementById(this.id);e.style.setProperty('display','block'),e.classList.add('show');}close(){let e=document.getElementById(this.id);e.style.setProperty('display','none'),e.classList.remove('show');}}export default LPDF;
